# Exploit-writing for OSWE

## Background

### What

This repository contains a list of useful snippets and tips that pertain to the writing of exploits in the OSWE labs and certification exam.

Some examples here may go against certain coding practices, but our end goal is to write the exploit script fast and correct.

### Why

* While there are many write-ups, reviews, and notes on the certification, few resources specifically focus on the process of writing exploits.
* Writing the exploit script can be daunting, especially for those who are new to Python or have little experience interacting with web applications through code.
* Time spent on identifying vulnerabilities and documenting an exam report can fluctuate considerably, but the time allocated to developing the exploit script can be minimized and kept constant if mastered well.

---


## Table of Contents

<!-- TODO -->

---

## Code Snipperts

### Starting Template

```python
import requests

def main():
    print("Hello World!")

if __name__ == __main__:
    main()

```

### Useful Imports

```python
# For sending HTTP requests
import requests

# For Base64 encoding/decoding
from base64 import b64encode, b64decode, urlsafe_b64encode, urlsafe_b64decode

# For getting current time or for calculating time delays
from time import time

# For regular expressions
import re

# For running shell commands
import subprocess

# For multithreading
from concurrent.futures import ThreadPoolExecutor

# For running a HTTP server
from http.server import HTTPServer, BaseHTTPRequestHandler

# For getting command-line arguments
import sys
```

### Using the `requests` library

#### Sending the simplest HTTP request

```python
resp_obj = requests.get("https://github.com")
```

#### Specifying different HTTP methods

```python
# GET method
requests.get("https://github.com")

# POST method
requests.post("https://github.com")

# PUT method
requests.put("https://github.com")

# PATCH method
requests.patch("https://github.com")

# DELETE method
requests.delete("https://github.com")
```

#### Reading the HTTP response

```python
resp_obj = requests.get("https://github.com")

# As bytes
resp_obj.content

# As a string
resp_obj.text

# As a dictionary (if response body is a JSON)
resp_obj.json()
```

#### Sending data as URL parameters (Using `params` argument)

```python
# Special characters (e.g '=') are automatically URL-encoded before appended to the URL
params = {
    "foo": "bar"
}

requests.get("https://github.com", params=params)
```

#### Sending data as a query string in the body (Using `data` argument)

```python
data = {
    "foo": "bar"
}

requests.post("https://github.com", data=data)
```

#### Sending data as a JSON in the body (Using `json` argument)

```python
data = {
    "foo": "bar"
}

requests.post("https://github.com", json=data)
```

#### Sending a file in the body (Using `files` argument)

```python
# (FILE_NAME, FILE_CONTENTS, FILE_MIMETYPE)
files = {
    "uploaded_file": ("phpinfo.php", b"<?php phpinfo() ?>", "application/x-httpd-php")
}

requests.post("https://github.com", files=files)
```

#### Setting HTTP headers (Using `headers` argument)

```python
headers = {
    "X-Forwarded-For": "127.0.0.1"
}

requests.get("https://github.com", headers=headers)
```

#### Setting HTTP cookies (Using `cookies` argument)

```python
cookies = {
    "PHPSESSID": "fakesession"
}

requests.get("https://github.com", cookies=cookies)
```

#### Disabling following of `3XX` redirects (Using `allow_redirects` argument)

```python
requests.post("https://github.com/login", allow_redirects=False)
```

#### Interacting with an unverified HTTPS server (Using `verify` argument)

```python
# Supresses InsecureRequestWarning messages
requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)

requests.get("https://github.com", verify=False)
```

#### Creating a `Session`

```python
session = requests.Session()

session.get("https://github.com")
```

### Troubleshooting

#### Use Wireshark and filter for HTTP requests

1) Open Wireshark
2) Select the VPN interface (e.g `tun0`)
3) Enter `http` into the filter bar.

#### Print contents of the HTTP request

```python
data = {
    "foo": "bar"
}
resp_obj = requests.post("https://github.com", data=data)
prepared_request = resp_obj.request

print("Method:\n", prepared_request.method)
print()
print("URL:\n", prepared_request.url)
print()
print("Headers:\n", prepared_request.headers)
print()
print("Body:\n", prepared_request.body)
```